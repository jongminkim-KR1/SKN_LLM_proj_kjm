# ⚾ MLB Manager Simulator

> AI 기반 야구 감독 시뮬레이터 - 실시간 전략 결정과 마운드 대화로 경기를 이끌어가세요

<div align="center">

![Python](https://img.shields.io/badge/Python-3.9+-blue.svg)
![Streamlit](https://img.shields.io/badge/Streamlit-1.28+-red.svg)
![OpenAI](https://img.shields.io/badge/OpenAI-GPT--4o--mini-green.svg)
![Ollama](https://img.shields.io/badge/Ollama-EEVE--Korean-orange.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

</div>

---

## 📌 목차

- [프로젝트 배경](#-프로젝트-배경)
- [주요 기능](#-주요-기능)
- [게임 규칙](#-게임-규칙)
- [선수 데이터 구성](#-선수-데이터-구성)
- [스탯 시스템](#-스탯-시스템)
- [기술 스택](#-기술-스택)
- [설치 및 실행](#-설치-및-실행)
- [프로젝트 구조](#-프로젝트-구조)
- [라이선스](#-라이선스)

---

## 🎯 프로젝트 배경

### "야구는 결정의 게임이다"

야구는 다른 스포츠와 달리 **상황별로 무수히 많은 선택지**가 존재하는 전략 게임입니다.

- 5회말 2사 만루, 선발투수를 계속 믿을 것인가?
- 7회초 1점차 리드, 상대 4번 타자 앞에서 고의4구를 할 것인가?
- 9회말 동점 상황, 번트를 대느냐 강타를 노리느냐?

이러한 **결정적 순간의 선택**이 경기의 흐름을 완전히 바꿉니다.

### 시뮬레이션의 필요성

기존의 야구 게임들은 대부분:
- 단순한 확률 기반 자동 진행
- 세이버 메트릭스 반영하지 않은 클래식 지표만 사용
- 제한적인 전략 옵션
- 일방적인 명령 전달

**이 프로젝트는 다릅니다:**
- ✅ **실시간 대화**: AI 투수/포수와 직접 대화하며 상황 파악
- ✅ **맥락 기반 조언**: 현재 상황을 분석한 AI 코치의 전략 조언
- ✅ **확률적 시뮬레이션**: 20-80 스케일 기반의 현실적인 능력치 시스템
- ✅ **역동적인 경기 흐름**: 투수 피로도, 연속 안타, 위기 상황 등 실시간 변화

야구의 모든 변수와 상황을 **시뮬레이션하고 직접 결정**할 수 있는 경험을 제공합니다.

---

## ✨ 주요 기능

### 1. 🎮 실시간 타석 시뮬레이션
- 20-80 스케일 기반 확률 계산
- 투수 피로도, 동일 투타 매치업, 주자 상황 등 변수 반영
- 볼넷, 삼진, 안타(단타/2루타/3루타/홈런), 아웃 등 다양한 결과

### 2. 🧠 AI 코치 조언 시스템 (Ollama EEVE-Korean)
- 타자/투수 능력치 분석
- 현재 경기 상황(점수차, 이닝, 아웃카운트, 주자) 고려
- 3가지 전략 추천 및 각각의 장단점 설명
- 한국어 자연어로 설명

### 3. 🗣️ 마운드 방문 이벤트 (OpenAI GPT-4o-mini)
#### 자동 트리거 조건:
- 투수 피로도 75% 이상
- 연속 안타 3개 이상 허용
- 득점권 위기 상황 (2/3루 주자 + 1아웃 이하)
- 만루 상황
- 7회 이후 리드 중 실점 위기

#### 대화 시스템:
1. **포수와 투수의 초기 대화** (AI 생성)
   - 포수: 투수 상태 보고 및 조언
   - 투수: 현재 컨디션 및 의지 표현
2. **감독(사용자) 입력**
   - 자유롭게 투수에게 말하기
3. **AI 반응 생성**
   - 감독의 말에 대한 투수/포수의 자연스러운 반응
4. **결정**
   - 계속 투구 / 투수 교체

### 4. 💬 실시간 팬 채팅 (OpenAI GPT-4o-mini)
- 타석 결과에 따른 5-7명의 팬 반응 생성
- 다양한 감정과 채팅체 표현
- 경기 상황(점수차, 이닝)에 따라 다른 분위기

### 5. 📊 실시간 게임 상태 표시
- 스코어보드 (이닝별 점수)
- 현재 투타 대결 (선수 사진, 능력치, 2025 시즌 실제 성적)
- 주자 상황, 볼/스트라이크 카운트
- 플레이 로그 (최근 5개 플레이)

### 6. 🎯 전략 시스템
#### 투구 전략:
- **적극 승부**: 삼진율↑ 볼넷↓ 피안타율↑ (위험한 승부)
- **신중하게**: 삼진율↓ 볼넷↑ 피안타율↓ (안전한 투구)
- **고의4구**: 강타자 피하고 다음 타자 상대

#### 타격 전략:
- **적극 스윙**: 장타율↑ 삼진율↑ 볼넷↓ (홈런 노림)
- **컨택 중심**: 안타율↑ 삼진율↓ 장타율↓ (안타로 출루)
- **볼넷 노림**: 볼넷율↑ 안타율↓ (끈기있게 볼 골라내기)

---

## 🎲 게임 규칙

### 기본 룰
- **9이닝 정규 경기** (연장 가능)
- 홈/어웨이 팀 선택
- 각 팀 9명 타자 라인업 + 선발투수 선택
- 3아웃 시 공수 교대

### 타석 진행
1. 현재 타자 vs 투수 매치업 확인
2. AI 코치 조언 받기 (선택)
3. 전략 선택 또는 전략 없이 진행
4. 결과 확인 및 팬 반응 보기

### 투수 관리
- **피로도**: 투구 수에 따라 자동 증가 (120구 기준 100%)
- **구위 저하**: 피로도 70% 이상 시 능력치 하락
- **교체 타이밍**: 사용자가 직접 결정
- **불펜 관리**: 선발이 아닌 모든 투수가 불펜으로 대기

### 마운드 방문
- 위기 상황 발생 시 자동 트리거
- 또는 "🗣️ 마운드 방문" 버튼으로 수동 실행
- 투수/포수와 대화하며 컨디션 파악
- 계속 투구 or 교체 결정

---

## 👥 선수 데이터 구성

### 데이터 소스
- **MLB 공식 API**: 선수 기본 정보, 사진
- **FanGraphs**: 2025 시즌 실제 성적 데이터
- **20-80 스케일 변환**: 실제 스탯을 스카우트 등급으로 변환

### 현재 구현 팀 (NL West 5개 팀)
- ⚾ Los Angeles Dodgers
- ⚾ San Diego Padres
- ⚾ Arizona Diamondbacks
- ⚾ San Francisco Giants
- ⚾ Colorado Rockies

### 선수 정보 구조
```json
{
  "id": 660271,
  "name": "Shohei Ohtani",
  "position": "DH",
  "bats": "L",
  "throws": "R",
  "team": "Dodgers",
  "stats_2024": {
    "gamesPlayed": 159,
    "avg": ".310",
    "homeRuns": 54,
    "rbi": 130,
    "hits": 197,
    "runs": 134,
    "ops": "1.036"
  },
  "ratings_20_80": {
    "contact": 70,
    "power": 80,
    "eye": 65,
    "speed": 60,
    "overall": 74
  }
}
```

---

## 📊 스탯 시스템

### 20-80 스케일이란?
프로 야구 스카우트가 사용하는 등급 시스템:
- **80**: MLB 최고 수준 (Top 1%)
- **70**: All-Star 수준
- **60**: 평균 이상 레귤러
- **50**: 평균 MLB 선수
- **40**: 평균 이하
- **30**: 벤치 선수
- **20**: 메이저리그 최저 수준

### 타자 능력치
| 능력치 | 설명 | 영향 |
|--------|------|------|
| **Contact** | 배트 컨트롤, 타구 정확도 | 안타율, 삼진율 |
| **Power** | 장타력, 비거리 | 홈런율, 장타율 |
| **Eye** | 선구안, 볼 분별 능력 | 볼넷율, 헛스윙 |
| **Speed** | 주루 속도 | 도루, 내야안타 |
| **Overall** | 종합 평가 | - |

### 투수 능력치
| 능력치 | 설명 | 영향 |
|--------|------|------|
| **Stuff** | 구위, 공의 위력 | 삼진율, 피안타율 |
| **Movement** | 구질 변화량 | 장타 허용률 |
| **Control** | 제구력 | 볼넷율 |
| **Stamina** | 체력, 지구력 | 선발/불펜 구분 |
| **Overall** | 종합 평가 | - |

### 확률 계산 예시
- 확률 계산의 가장 첫번째 수는 MLB 2025시즌 평균 값
#### 볼넷 확률
```python
walk_rate = 8.5 + (타자_eye - 50)/50 * 4 - (투수_control - 50)/50 * 3
# 득점권 상황 +1.5%
# 투수 피로도 70% 이상 +1.5%
# 투수 피로도 85% 이상 추가 +2.5%
# 최종 범위: 3% ~ 18%
```

#### 삼진 확률
```python
k_rate = 23.0 - (타자_contact - 50)/50 * 8 + (투수_stuff - 50)/50 * 7
# 투수 피로도 70% 이상 -3%
# 투수 피로도 85% 이상 추가 -5%
# 동일 투타(예: 우투수 vs 우타자) +2%
# 최종 범위: 10% ~ 40%
```

#### 안타 확률
```python
hit_rate = 25.0 + (타자_contact - 50)/50 * 10 - (투수_stuff - 50)/50 * 8
# 투수 피로도 70% 이상 +3%
# 투수 피로도 85% 이상 추가 +5%
# 동일 투타 -2%
# 최종 범위: 15% ~ 40%
```

#### 홈런 확률 (안타 발생 시)
```python
hr_rate = 14.0 + (타자_power - 50)/50 * 8 - (투수_movement - 50)/50 * 4
# 전략 보정(적극 스윙 사용 시 * 1.3)
# 최종 범위: 2% ~ 30%
```

### 실제 스탯 → 20-80 변환 예시

#### 타자 Contact 능력치
```python
if avg >= 0.300:  # MVP급
    contact = 70 + (avg - 0.300) / 0.040 * 10
elif avg >= 0.270:  # 평균 이상
    contact = 55 + (avg - 0.270) / 0.030 * 15
else:  # 평균 이하
    contact = 40 + (avg - 0.230) / 0.040 * 15
```

#### 타자 Power 능력치
```python
if hr >= 40:  # 홈런왕급
    power = 70 + (hr - 40) / 20 * 10
elif hr >= 25:  # 강타자
    power = 55 + (hr - 25) / 15 * 15
else:  # 일반
    power = 40 + hr / 25 * 15
```

---

## 🛠️ 기술 스택

### Frontend
- **Streamlit 1.28+**: 웹 UI 프레임워크
- **Python 3.9+**: 메인 언어

### AI/LLM
- **Ollama**: 로컬 LLM 서버
  - 모델: `EEVE-Korean-10.8B` (한국어 특화)
  - 용도: AI 코치 전략 조언
- **OpenAI GPT-4o-mini**: 클라우드 LLM API
  - 용도: 마운드 대화 생성, 팬 채팅 생성

### Backend
- **구조**: 모듈화된 게임 엔진
  - `game_engine/`: 게임 로직 (타석 시뮬레이션, 상태 관리)
  - `ai/`: LLM 클라이언트 및 프롬프트 생성

### Data
- **MLB Stats API**: 선수 정보 및 사진
- **FanGraphs**: 실제 야구 통계

---

## 🚀 설치 및 실행

### 1. 사전 요구사항

#### Python 환경
```bash
python --version  # 3.9 이상 필요
```

#### Ollama 설치 (AI 코치 기능용)

**방법 1: 자동 설치 스크립트 (권장)**
```bash
# Ollama 설치 + EEVE-Korean 모델 자동 다운로드
bash scripts/setup/run_all.sh
```

**방법 2: 수동 설치**
```bash
# macOS/Linux
curl -fsSL https://ollama.com/install.sh | sh

# 서버 시작
ollama serve

# 한국어 모델 다운로드 (새 터미널)
ollama pull EEVE-Korean-10.8B
```

#### OpenAI API 키 (마운드 대화, 팬 채팅용)
1. https://platform.openai.com/api-keys 에서 키 발급
2. `.env` 파일에 추가 (아래 참고)

---

### 2. 프로젝트 설치

```bash
# 1. 레포지토리 클론
git clone https://github.com/yourusername/mlb-manager-simulator.git
cd mlb-manager-simulator

# 2. 의존성 설치
pip install -r requirements.txt

# 3. 환경 변수 설정
cd backend
cat > .env << EOF
OPENAI_API_KEY=your_openai_api_key_here
OLLAMA_BASE_URL=http://localhost:11434
EOF
cd ..
```

---

### 3. 실행

```bash
# Streamlit 앱 실행
streamlit run app.py
```

브라우저가 자동으로 열리며 `http://localhost:8501` 접속

---

### 4. 사용 방법

1. **팀 선택**
   - 홈팀과 원정팀 선택
   - 선발 라인업 9명 구성
   - 선발 투수 선택

2. **게임 시작**
   - "게임 시작" 버튼 클릭
   - 실시간 스코어보드 확인

3. **타석 진행**
   - 현재 타자 vs 투수 매치업 확인
   - (선택) "AI 코치 조언 받기" 버튼 → 전략 선택
   - "타석 진행" 버튼으로 결과 확인

4. **마운드 방문**
   - 위기 상황 발생 시 자동 팝업
   - 또는 "🗣️ 마운드 방문" 버튼 클릭
   - 투수/포수와 대화 후 결정

5. **투수 교체**
   - "투수 교체" 버튼 클릭
   - 불펜 투수 선택

6. **팬 채팅 보기**
   - "팬 채팅 보기" 버튼으로 실시간 반응 확인

---

## 📁 프로젝트 구조

```
mlb-manager-simulator/
├── app.py                          # 메인 Streamlit 앱
├── requirements.txt                # Python 의존성
├── README.md                       # 프로젝트 문서
├── backend/
│   ├── .env                        # 환경 변수 (API 키)
│   └── app/
│       ├── game_engine/            # 게임 로직
│       │   ├── __init__.py
│       │   ├── game_state.py       # 게임 상태 관리
│       │   ├── at_bat_simulator.py # 타석 확률 계산
│       │   └── strategy.py         # 전략 보정 시스템
│       └── ai/                     # AI 시스템
│           ├── __init__.py
│           ├── ollama_client.py    # Ollama LLM 클라이언트
│           ├── strategy_advisor.py # AI 코치 프롬프트
│           └── commentary.py       # 실시간 중계 생성
├── data/
│   └── mlb/
│       └── nl_west/
│           └── teams/              # 팀별 JSON 데이터
│               ├── dodgers.json
│               ├── padres.json
│               ├── diamondbacks.json
│               ├── giants.json
│               └── rockies.json
└── scripts/
    └── data_collection/            # 데이터 수집 스크립트
        ├── collect_mlb_data.py     # MLB API에서 선수 정보 수집
        ├── enrich_with_fangraphs.py # FanGraphs 스탯 추가
        └── convert_stats_20_80.py  # 20-80 스케일 변환
```

---

## 🎮 게임 플레이 예시

### 시나리오: 7회말 1점 차 리드, 만루 위기

```
[게임 상황]
- 이닝: 7회말
- 점수: 원정 3 - 4 홈 (홈팀 1점 리드)
- 아웃: 1아웃
- 주자: 만루
- 투수: Kershaw (98구, 피로도 82%)
- 타자: Tatis Jr. (Power 75)

[마운드 방문 자동 트리거]
⚾ 마운드 방문 - 만루 위기

포수: "감독님, Kershaw 슬라이더 구위가 많이 떨어졌습니다.
       마지막 이닝 구속도 3km 빠졌어요."

Kershaw: "좀 지쳤지만... 이 타자까지는 제가 잡고 싶습니다.
          믿어주시면 끝까지 책임지겠습니다."

포수: "피로도가 확실히 보여요. 감독님 판단 부탁드립니다."

💬 감독(당신)의 말:
> "커쇼, 고생했어. 여기서 쉬자. 불펜 올린다."

Kershaw: "...알겠습니다, 감독님. 죄송합니다."

[투수 교체]
→ Treinen (Setup, Stuff 72) 등판

[결과]
Treinen이 Tatis Jr.를 내야땅볼로 처리!
병살 실패, 1점 내주고 2아웃
→ 최소 실점으로 위기 모면
```

---

## 📝 향후 개발 계획

### Phase 2
- [ ] 전체 MLB 30개 팀 데이터 추가
- [ ] 대타/대주자 시스템
- [ ] 도루/견제구 시스템
- [ ] 수비 시프트 전략
- [ ] 상대방 수비 위치보고 당겨치거나 밀어치는 전략

### Phase 3
- [ ] 시즌 모드 (162경기)
- [ ] 선수 트레이드 및 FA 영입
- [ ] 부상 시스템
- [ ] 선수 육성 및 성장

### Phase 4
- [ ] 멀티플레이어 (PvP)
- [ ] 리그 랭킹 시스템
- [ ] 토너먼트 모드

---


## 📄 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다. 자세한 내용은 [LICENSE](LICENSE) 파일을 참조하세요.

---



<div align="center">

⚾ **Play Ball!** ⚾

*Made with ❤️ for baseball fans and strategy game lovers*

</div>
